<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ndsensor monitor</title>
  </head>
  <body>
    <h1>ndsensor monitor</h1>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var http_post = function (where, text_to_send, callback) {
        if (typeof where !== 'string') throw TypeError();
        if (typeof text_to_send !== 'string') throw TypeError();
        if (typeof callback !== 'function') throw TypeError();

        fetch(where, {method: 'POST', body: text_to_send})
          .then(function (response) {
            return response.text();
          })
          .then(function (server_response_text) {
            callback(server_response_text);
          })
          .catch(function (err) {
            callback(null, err);
          });
      };

      var socket = io('http://' + location.host + '/');

      socket.on('view_updated', render);

      var current_view = [];
      function render(new_view) {
          current_view = new_view;
          console.log(JSON.stringify(current_view));
      }

      /*

      id = setInterval(()=>{  http_post('/view', '', result => console.log(result))  }, 1000)
      clearInterval(id)

      http_post('/moni', 'ndsensor-1', ()=>{})

      http_post('/dismoni', 'ndsensor-1', ()=>{})

      */

    </script>
  </body>
</html>
